{% extends 'base.html' %}

{% block title %}{{ church.name }} Church - RuweHolyGhostChurch{% endblock %}

{% block page_title %}{{ church.name }} Church{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <!-- Church Information Card -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-home" style="color: #dc2626; margin-right: 10px;"></i>
                    Church Information
                </h5>
                <div style="float: right;">
                    <a href="{% url 'church_structure:edit_church' church_slug=church.slug %}"
                       class="btn btn-primary btn-sm">
                        <i class="fas fa-edit"></i> Edit Church
                    </a>
                    {% if church.has_detailed_description %}
                    <a href="{% url 'church_structure:church_description' church_slug=church.slug %}" 
                       class="btn btn-info btn-sm">
                        <i class="fas fa-book-open"></i> About Church
                    </a>
                    {% endif %}
                    <a href="{% url 'church_structure:pastorate_detail' pastorate_slug=church.pastorate.slug %}"
                       class="btn btn-primary btn-sm">
                        <i class="fas fa-users"></i> View Pastorate
                    </a>
                    <a href="{% url 'church_structure:index' %}" class="btn btn-secondary btn-sm">
                        <i class="fas fa-arrow-left"></i> Back
                    </a>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Church Name:</strong> {{ church.name }}</p>
                        <p><strong>Identifier:</strong> {{ church.identifier }}</p>
                        <p><strong>Pastorate:</strong> {{ church.pastorate.name }}</p>
                        <p><strong>Diocese:</strong> {{ church.pastorate.diocese.name }}</p>
                        <p><strong>Location:</strong> {{ church.location }}</p>
                        {% if church.map_link %}
                            <p><strong>Map Link:</strong> <a href="{{ church.map_link }}" target="_blank" style="color: #3b82f6;">üìç View on Google Maps</a></p>
                        {% endif %}
                        <p><strong>Service Time:</strong> {{ church.service_times }}</p>
                        <div style="margin-top: 10px;">
                            <strong>Church Type:</strong><br>
                            {% if church.is_headquarter_church %}
                                <span style="background: #dc2626; color: white; padding: 4px 8px; border-radius: 4px; margin-right: 5px;">HEADQUARTER CHURCH</span>
                            {% endif %}
                            {% if church.is_diocesan_church %}
                                <span style="background: #7c3aed; color: white; padding: 4px 8px; border-radius: 4px; margin-right: 5px;">DIOCESAN CHURCH</span>
                            {% endif %}
                            {% if church.is_mission_church %}
                                <span style="background: #059669; color: white; padding: 4px 8px; border-radius: 4px; margin-right: 5px;">MISSION CHURCH</span>
                            {% endif %}
                            {% if not church.is_headquarter_church and not church.is_diocesan_church and not church.is_mission_church %}
                                <span style="color: #9ca3af;">Regular Church</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Head Teacher:</strong> {{ church.head_teacher_name }}</p>
                        <p><strong>Head Teacher Phone:</strong> {{ church.head_teacher_phone|default:"Not provided" }}</p>
                        <p><strong>Head Teacher Email:</strong> {{ church.head_teacher_email|default:"Not provided" }}</p>
                        <p><strong>Church Phone:</strong> {{ church.phone|default:"Not provided" }}</p>
                        <p><strong>Church Email:</strong> {{ church.email|default:"Not provided" }}</p>
                        <p><strong>Capacity:</strong> {{ church.capacity|default:"Not specified" }}</p>
                        <p><strong>Established:</strong> {{ church.established_date|default:"Not specified" }}</p>
                        <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 4px; margin-top: 10px;">
                            <small style="color: #9ca3af;">
                                <strong>Note:</strong> A Sabbath Day starts on Friday 6:00 PM to Saturday 6:00 PM (24 hours). All Sabbaths are held on Saturday. All Sabbaths MUST end by 6:00 PM Saturday.
                            </small>
                        </div>
                    </div>
                </div>

                {% if church.service_times %}
                <div class="row mt-3">
                    <div class="col-md-6">
                        <p><strong>Service Times:</strong></p>
                        <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 4px;">
                            {{ church.service_times|linebreaks }}
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if church.assistant_teachers %}
                <div class="row mt-3">
                    <div class="col-md-6">
                        <p><strong>Assistant Teachers:</strong></p>
                        <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 4px;">
                            {{ church.assistant_teachers|linebreaks }}
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Church Hierarchy Information -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-sitemap" style="color: #dc2626; margin-right: 10px;"></i>
                    Church Hierarchy Information
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <!-- Archbishop Information -->
                    <div class="col-md-4 mb-3">
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 6px; border-left: 4px solid #dc2626;">
                            <h6 style="color: #ffffff; margin-bottom: 10px;">
                                <i class="fas fa-crown" style="color: #fbbf24; margin-right: 8px;"></i>
                                Archbishop
                            </h6>
                            {% if archbishop %}
                                <p style="color: #e5e7eb; margin-bottom: 5px;">
                                    <strong>{{ archbishop.full_name }}</strong>
                                </p>
                                {% if archbishop.phone %}
                                <p style="color: #9ca3af; margin-bottom: 5px; font-size: 0.9em;">
                                    <i class="fas fa-phone" style="margin-right: 5px;"></i>
                                    {{ archbishop.phone }}
                                </p>
                                {% endif %}
                                {% if archbishop.email %}
                                <p style="color: #9ca3af; margin-bottom: 0; font-size: 0.9em;">
                                    <i class="fas fa-envelope" style="margin-right: 5px;"></i>
                                    {{ archbishop.email }}
                                </p>
                                {% endif %}
                            {% else %}
                                <p style="color: #9ca3af; font-style: italic; font-size: 0.9em;">
                                    <i class="fas fa-info-circle" style="margin-right: 5px;"></i>
                                    Archbishop information not available
                                </p>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Headquarters Information -->
                    <div class="col-md-4 mb-3">
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 6px; border-left: 4px solid #7c3aed;">
                            <h6 style="color: #ffffff; margin-bottom: 10px;">
                                <i class="fas fa-landmark" style="color: #7c3aed; margin-right: 8px;"></i>
                                Headquarters
                            </h6>
                            <p style="color: #e5e7eb; margin-bottom: 5px;">
                                <strong>Ruwe Archcathedral Church</strong>
                            </p>
                            <p style="color: #9ca3af; margin-bottom: 8px; font-size: 0.9em;">
                                <i class="fas fa-map-marker-alt" style="margin-right: 5px;"></i>
                                Ruwe Location
                            </p>
                            <a href="https://maps.google.com/?q=Ruwe+Archcathedral+Church+Ruwe" 
                               target="_blank" 
                               style="color: #3b82f6; text-decoration: none; font-size: 0.85em;">
                                <i class="fas fa-external-link-alt" style="margin-right: 5px;"></i>
                                View on Google Maps
                            </a>
                        </div>
                    </div>

                    <!-- King Information -->
                    <div class="col-md-4 mb-3">
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 6px; border-left: 4px solid #f59e0b;">
                            <h6 style="color: #ffffff; margin-bottom: 10px;">
                                <i class="fas fa-chess-king" style="color: #f59e0b; margin-right: 8px;"></i>
                                King
                            </h6>
                            {% if king %}
                                <p style="color: #e5e7eb; margin-bottom: 5px;">
                                    <strong>{{ king.full_name }}</strong>
                                </p>
                                {% if king.phone %}
                                <p style="color: #9ca3af; margin-bottom: 5px; font-size: 0.9em;">
                                    <i class="fas fa-phone" style="margin-right: 5px;"></i>
                                    {{ king.phone }}
                                </p>
                                {% endif %}
                                {% if king.email %}
                                <p style="color: #9ca3af; margin-bottom: 0; font-size: 0.9em;">
                                    <i class="fas fa-envelope" style="margin-right: 5px;"></i>
                                    {{ king.email }}
                                </p>
                                {% endif %}
                            {% else %}
                                <p style="color: #9ca3af; font-style: italic; font-size: 0.9em;">
                                    <i class="fas fa-info-circle" style="margin-right: 5px;"></i>
                                    King information not available
                                </p>
                            {% endif %}
                        </div>
                    </div>

                    <!-- King's Place Information -->
                    <div class="col-md-4 mb-3">
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 6px; border-left: 4px solid #059669;">
                            <h6 style="color: #ffffff; margin-bottom: 10px;">
                                <i class="fas fa-monument" style="color: #059669; margin-right: 8px;"></i>
                                King's Place
                            </h6>
                            <p style="color: #e5e7eb; margin-bottom: 5px;">
                                <strong>The King's Pillar</strong>
                            </p>
                            <p style="color: #9ca3af; margin-bottom: 8px; font-size: 0.9em;">
                                <i class="fas fa-map-marker-alt" style="margin-right: 5px;"></i>
                                Musanda Location
                            </p>
                            <a href="https://maps.google.com/?q=The+King's+Pillar+Musanda" 
                               target="_blank" 
                               style="color: #3b82f6; text-decoration: none; font-size: 0.85em;">
                                <i class="fas fa-external-link-alt" style="margin-right: 5px;"></i>
                                View on Google Maps
                            </a>
                        </div>
                    </div>

                    <!-- Bishop Information -->
                    <div class="col-md-4 mb-3">
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 6px; border-left: 4px solid #6366f1;">
                            <h6 style="color: #ffffff; margin-bottom: 10px;">
                                <i class="fas fa-mitre" style="color: #6366f1; margin-right: 8px;"></i>
                                Bishop
                            </h6>
                            <p style="color: #e5e7eb; margin-bottom: 5px;">
                                <strong>{{ church.pastorate.diocese.bishop_name }}</strong>
                            </p>
                            {% if church.pastorate.diocese.bishop_phone %}
                            <p style="color: #9ca3af; margin-bottom: 5px; font-size: 0.9em;">
                                <i class="fas fa-phone" style="margin-right: 5px;"></i>
                                {{ church.pastorate.diocese.bishop_phone }}
                            </p>
                            {% endif %}
                            {% if church.pastorate.diocese.bishop_email %}
                            <p style="color: #9ca3af; margin-bottom: 0; font-size: 0.9em;">
                                <i class="fas fa-envelope" style="margin-right: 5px;"></i>
                                {{ church.pastorate.diocese.bishop_email }}
                            </p>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Diocesan Church Information -->
                    <div class="col-md-4 mb-3">
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 6px; border-left: 4px solid #8b5cf6;">
                            <h6 style="color: #ffffff; margin-bottom: 10px;">
                                <i class="fas fa-church" style="color: #8b5cf6; margin-right: 8px;"></i>
                                Diocesan Church
                            </h6>
                            {% if diocesan_church %}
                                <p style="color: #e5e7eb; margin-bottom: 5px;">
                                    <strong>{{ diocesan_church.name }}</strong>
                                </p>
                                <p style="color: #9ca3af; margin-bottom: 8px; font-size: 0.9em;">
                                    <i class="fas fa-map-marker-alt" style="margin-right: 5px;"></i>
                                    {{ diocesan_church.location }}
                                </p>
                                <a href="{% url 'church_structure:church_detail' church_slug=diocesan_church.slug %}"
                                   style="color: #3b82f6; text-decoration: none; font-size: 0.85em;">
                                    <i class="fas fa-eye" style="margin-right: 5px;"></i>
                                    View Church Details
                                </a>
                            {% else %}
                                <p style="color: #9ca3af; font-style: italic; font-size: 0.9em;">
                                    <i class="fas fa-info-circle" style="margin-right: 5px;"></i>
                                    Diocesan Church not assigned
                                </p>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Pastor Information -->
                    <div class="col-md-4 mb-3">
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 6px; border-left: 4px solid #14b8a6;">
                            <h6 style="color: #ffffff; margin-bottom: 10px;">
                                <i class="fas fa-pray" style="color: #14b8a6; margin-right: 8px;"></i>
                                Pastor
                            </h6>
                            <p style="color: #e5e7eb; margin-bottom: 5px;">
                                <strong>{{ church.pastorate.pastor_name }}</strong>
                            </p>
                            {% if church.pastorate.pastor_phone %}
                            <p style="color: #9ca3af; margin-bottom: 5px; font-size: 0.9em;">
                                <i class="fas fa-phone" style="margin-right: 5px;"></i>
                                {{ church.pastorate.pastor_phone }}
                            </p>
                            {% endif %}
                            {% if church.pastorate.pastor_email %}
                            <p style="color: #9ca3af; margin-bottom: 0; font-size: 0.9em;">
                                <i class="fas fa-envelope" style="margin-right: 5px;"></i>
                                {{ church.pastorate.pastor_email }}
                            </p>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Mission Church Information -->
                    <div class="col-md-4 mb-3">
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 6px; border-left: 4px solid #f97316;">
                            <h6 style="color: #ffffff; margin-bottom: 10px;">
                                <i class="fas fa-cross" style="color: #f97316; margin-right: 8px;"></i>
                                Mission Church
                            </h6>
                            {% if mission_church %}
                                <p style="color: #e5e7eb; margin-bottom: 5px;">
                                    <strong>{{ mission_church.name }}</strong>
                                </p>
                                <p style="color: #9ca3af; margin-bottom: 8px; font-size: 0.9em;">
                                    <i class="fas fa-map-marker-alt" style="margin-right: 5px;"></i>
                                    {{ mission_church.location }}
                                </p>
                                <a href="{% url 'church_structure:church_detail' church_slug=mission_church.slug %}"
                                   style="color: #3b82f6; text-decoration: none; font-size: 0.85em;">
                                    <i class="fas fa-eye" style="margin-right: 5px;"></i>
                                    View Church Details
                                </a>
                            {% else %}
                                <p style="color: #9ca3af; font-style: italic; font-size: 0.9em;">
                                    <i class="fas fa-info-circle" style="margin-right: 5px;"></i>
                                    Mission Church not assigned
                                </p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Church Members -->
        <div class="card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-users" style="color: #dc2626; margin-right: 10px;"></i>
                    Church Members ({{ members.count }})
                </h5>
            </div>
            <div class="card-body">
                {% if members %}
                <div class="table-responsive">
                    <table class="table table-dark table-striped" style="background: #1f2937;">
                        <thead style="background: #dc2626;">
                            <tr>
                                <th style="padding: 12px; color: white; border: 1px solid #374151;">Name</th>
                                <th style="padding: 12px; color: white; border: 1px solid #374151;">Phone</th>
                                <th style="padding: 12px; color: white; border: 1px solid #374151;">Email</th>
                                <th style="padding: 12px; color: white; border: 1px solid #374151;">Emergency Contact</th>
                                <th style="padding: 12px; color: white; border: 1px solid #374151;">Membership Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for member in members %}
                            <tr>
                                <td style="padding: 10px; border: 1px solid #374151;">
                                    <strong style="color: #ffffff;">{{ member.first_name }} {{ member.last_name }}</strong>
                                    {% if member.photo %}
                                    <br><small style="color: #9ca3af;">
                                        <i class="fas fa-image" style="margin-right: 5px;"></i>
                                        Has photo
                                    </small>
                                    {% endif %}
                                </td>
                                <td style="padding: 10px; border: 1px solid #374151; color: #e5e7eb;">
                                    {{ member.phone|default:"Not provided" }}
                                </td>
                                <td style="padding: 10px; border: 1px solid #374151; color: #e5e7eb;">
                                    {{ member.email|default:"Not provided" }}
                                </td>
                                <td style="padding: 10px; border: 1px solid #374151; color: #e5e7eb;">
                                    {% if member.emergency_contact_name %}
                                        <strong>{{ member.emergency_contact_name }}</strong><br>
                                        <small>{{ member.emergency_contact_phone|default:"No phone" }}</small>
                                    {% else %}
                                        Not provided
                                    {% endif %}
                                </td>
                                <td style="padding: 10px; border: 1px solid #374151;">
                                    <span style="padding: 4px 8px; border-radius: 4px; font-size: 0.8em;
                                               background: {% if member.membership_status == 'active' %}#10b981{% elif member.membership_status == 'inactive' %}#f59e0b{% else %}#6b7280{% endif %};
                                               color: white;">
                                        {{ member.get_membership_status_display|default:member.membership_status }}
                                    </span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div style="text-align: center; color: #9ca3af; font-style: italic; padding: 40px;">
                    <i class="fas fa-info-circle" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
                    No members registered for this church yet.
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}